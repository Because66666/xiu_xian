# 修仙世界模拟器

基于背景设定文档创建的修仙世界模拟程序，完整实现了修士修炼、战斗、晋升等机制。

## 背景设定

### 修炼等级
- **炼气(Lv0)**: 开始修炼年龄6-10岁（正态分布），10点修为晋升筑基
- **筑基(Lv1)**: 100点修为晋升结丹，寿元100年
- **结丹(Lv2)**: 1000点修为晋升元婴，寿元增加800年
- **元婴(Lv3)**: 10000点修为晋升化神，寿元增加8000年
- **化神(Lv4)**: 100000点修为晋升炼虚，寿元增加80000年
- **炼虚(Lv5)**: 1000000点修为晋升合体，寿元增加800000年
- **合体(Lv6)**: 10000000点修为晋升大乘，寿元增加8000000年
- **大乘(Lv7)**: 最高等级

### 核心机制

1. **修炼规则**
   - 每年固定增加1点修为
   - 开始修炼年龄：6-10岁正态分布（均值8岁，标准差1岁）
   - 筑基成功年龄 = 开始修炼年龄 + 10年
   - 每年新增1000名筑基修士

2. **战斗系统**
   - 同等级修士有概率在野外相遇
   - 相遇概率 = 该等级修士数量 / 总修士数量
   - 胜率 = 自己修为 / (双方修为之和)
   - 每个修士有固定的勇气值(0-1正态分布)
   - 当勇气值 > 战败率时选择战斗
   - 胜利者吸收败者一定比例的修为（可配置，默认10%）
   - **击败人数追踪**：每次战斗胜利都会记录击败人数

3. **生存压力**
   - 筑基期修士寿元有限，必须通过战斗获得额外修为才能晋升
   - 这创造了修仙界的竞争和杀戮环境

## 使用方法

### 基本运行
```bash
# 使用默认参数运行（100年，10%吸取比率）
python cultivation_simulator.py

# 自定义参数运行
python cultivation_simulator.py --years 200 --absorption-rate 0.15

# 运行演示模式
python cultivation_simulator.py --demo

# 运行时不显示进度报告
python cultivation_simulator.py --no-progress
```

### 命令行参数

- `--years N`: 设置模拟时长（年），默认100年
- `--absorption-rate X`: 设置修为吸取比率（0-1之间），默认0.1（10%）
- `--demo`: 运行演示模式，包含机制分析和30年短期模拟
- `--no-progress`: 不显示进度报告，只显示最终结果
- `--help`: 显示帮助信息

### 使用示例

```bash
# 模拟500年，修为吸取比率20%
python cultivation_simulator.py --years 500 --absorption-rate 0.2

# 运行演示模式，修为吸取比率5%
python cultivation_simulator.py --demo --absorption-rate 0.05

# 快速运行50年模拟，不显示进度
python cultivation_simulator.py --years 50 --no-progress
```

## 依赖库

```bash
pip install numpy matplotlib
```

## 程序特性

### 可配置参数
1. **模拟时长**: 可以设置任意年数的模拟时长
2. **修为吸取比率**: 可以调整战斗胜利者吸收败者修为的比例
3. **开始修炼年龄**: 改为6-10岁正态分布，更符合现实

### 统计功能
程序会生成以下统计信息：

1. **修士总数变化**: 显示每年修士数量的变化趋势
2. **战斗次数**: 每年发生的战斗数量
3. **死亡人数**: 每年因战斗死亡的修士数量
4. **击败人数统计**: 历年杀戮之王的击败人数变化趋势
5. **杀戮排行榜**: 在状态报告中显示击败人数最多的修士
6. **各等级修士平均勇气值统计**: 显示不同等级修士的平均勇气值
7. **各等级修士平均战斗次数统计**: 显示不同等级修士的平均战斗次数
8. **各等级修士平均寿元统计**: 显示不同等级修士的平均寿元

### 数据可视化
程序会自动生成以下统计图表：
1. **历年修士总数变化**: 显示不同年份修士数量的变化趋势
2. **每年战斗次数**: 显示每年发生的战斗次数统计
3. **结束时期各阶段修士人数对比**: 柱状图显示模拟结束时不同修炼阶段的修士人数（横坐标为中文阶段名称）
4. **结束时期各阶段修士平均勇气值对比**: 柱状图显示不同修炼阶段修士的平均勇气值

#### 数据采样优化

当模拟时间跨度较长（超过100个数据点）时，程序会自动进行数据采样优化：
- 自动计算合适的采样间隔，避免图表过于密集
- 确保包含首尾数据点，保持趋势完整性
- 图表标题会显示实际显示的数据点数量与总数据点的比例
- 采样后的图表仍能准确反映数据的整体趋势

所有图表都采用现代化的设计风格，包含数值标注和网格线，便于数据分析。

### 演示模式
演示模式包含：
- 修炼机制详细分析
- 战斗系统工作原理演示（包括击败人数追踪）
- 等级要求说明
- 详细的统计信息（各等级平均值）
- 最强修士的详细信息（出生年份、击败数、勇气值）
- 30年短期模拟运行
- 统计图表生成（包括杀戮之王击败数趋势）

## 模拟结果分析

通过不同参数的模拟可以观察到：

1. **修士数量动态平衡**: 虽然每年新增1000人，但战斗死亡和寿元耗尽维持了平衡
2. **等级分布**: 大部分修士停留在筑基期，高等级修士极其稀少
3. **吸取比率影响**: 
   - 高吸取比率：战斗更激烈，强者更容易晋升
   - 低吸取比率：需要更多战斗才能晋升，竞争更持久
4. **年龄分布影响**: 6-10岁开始修炼的正态分布使修士群体更加多样化

## 关键发现

- **战斗是晋升的必要条件**: 验证了背景设定中"杀人才能晋升"的设计理念
- **勇气值决定生存策略**: 高勇气修士更容易参与战斗，既有机会获得修为也面临死亡风险
- **参数敏感性**: 修为吸取比率对整个修仙界的生态平衡有显著影响
- **年龄多样性**: 开始修炼年龄的正态分布创造了更真实的修士群体
- **杀戮排行榜**: 击败人数追踪揭示了修仙界中的顶级杀手，通常杀戮之王和最强修士是同一人

## 技术特点

- **单文件设计**: 所有功能集成在一个文件中，便于使用和分发
- **命令行界面**: 支持多种参数配置，灵活性强
- **面向对象架构**: 代码结构清晰，易于理解和扩展
- **完整的统计系统**: 提供详细的数据分析和可视化
- **中文支持**: 完美支持中文显示和输出
- **参数验证**: 对输入参数进行合理性检查

## 扩展建议

可以进一步扩展的功能：

- 添加不同的修炼天赋系统
- 实现宗门和门派机制
- 添加法宝和功法系统
- 实现更复杂的战斗策略
- 添加地域和资源争夺
- 引入修炼瓶颈和突破机制
- 添加师父传承系统

## 文件说明

- `cultivation_simulator.py`: 主程序文件，包含所有功能
- `README.md`: 本说明文档
- `背景信息.md`: 原始背景设定文档

## 版本历史

- v2.4: 数据采样优化版本（当前版本）
  - 数据采样优化：当数据点超过100个时自动进行采样，避免图表过于密集
  - 智能间隔计算：根据数据量自动计算最佳采样间隔
  - 趋势保持：确保包含首尾数据点，保持数据趋势的完整性
  - 显示优化：图表标题显示实际数据点数量与总数据点的比例
  - 演示模式修复：修复演示模式下年数参数不生效的问题

- v2.3: 数据可视化版本
  - 重新设计统计图表，包含四个新图表：
    - 历年修士总数变化趋势图
    - 每年战斗次数统计图
    - 结束时期各阶段修士人数对比柱状图（中文横坐标）
    - 结束时期各阶段修士平均勇气值对比柱状图
  - 优化图表显示效果，添加数值标注和网格线
  - 改进图表布局和颜色搭配

- v2.2: 增强统计版本
  - 新增各等级修士平均统计功能（勇气值、战斗次数、寿元）
  - 增强最强修士信息显示（出生年份、击败数、勇气值）
  - 添加战斗次数追踪功能
  - 优化出生年份计算逻辑
  - 完善状况报告的详细程度

- v2.1: 击败追踪版本
  - 新增修士击败人数追踪功能
  - 在状态报告中显示杀戮之王信息
  - 统计图表中添加击败人数趋势
  - 演示模式中展示击败追踪机制

- v2.0: 优化版本
  - 合并为单文件设计
  - 添加命令行参数支持
  - 可配置修为吸取比率
  - 开始修炼年龄改为正态分布
  - 增强的演示模式

- v1.0: 初始版本
  - 基础修仙世界模拟
  - 固定参数设计
  - 多文件架构